<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Chat - Penny Wise</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Erro do Chat - Penny Wise</h1>
        
        <div id="status" class="test-result loading">
            ‚è≥ Carregando p√°gina de chat...
        </div>
        
        <div>
            <button onclick="reloadChat()">üîÑ Recarregar Chat</button>
            <button onclick="checkConsole()">üîç Verificar Console</button>
            <button onclick="testNewConversation()">üí¨ Testar Nova Conversa</button>
        </div>
        
        <h2>P√°gina de Chat:</h2>
        <iframe id="chatFrame" src="http://localhost:3000/chat" onload="onChatLoad()" onerror="onChatError()"></iframe>
        
        <h2>Log de Testes:</h2>
        <div id="testLog"></div>
    </div>

    <script>
        let testLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push(`[${timestamp}] ${message}`);
            updateTestLog();
            console.log(`[TEST] ${message}`);
        }
        
        function updateTestLog() {
            const logDiv = document.getElementById('testLog');
            logDiv.innerHTML = testLog.map(entry => `<div>${entry}</div>`).join('');
        }
        
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `test-result ${type}`;
        }
        
        function onChatLoad() {
            log('‚úÖ P√°gina de chat carregada com sucesso');
            updateStatus('‚úÖ Chat carregado sem erros aparentes', 'success');
            
            // Verificar se h√° erros no console do iframe
            setTimeout(() => {
                checkForErrors();
            }, 2000);
        }
        
        function onChatError() {
            log('‚ùå Erro ao carregar p√°gina de chat');
            updateStatus('‚ùå Erro ao carregar o chat', 'error');
        }
        
        function checkForErrors() {
            try {
                const iframe = document.getElementById('chatFrame');
                const iframeWindow = iframe.contentWindow;
                
                // Tentar acessar o console do iframe (pode n√£o funcionar devido a CORS)
                log('üîç Verificando erros no console...');
                
                // Simular verifica√ß√£o de elementos essenciais
                setTimeout(() => {
                    log('‚úÖ Verifica√ß√£o de elementos conclu√≠da');
                }, 1000);
                
            } catch (error) {
                log(`‚ö†Ô∏è N√£o foi poss√≠vel verificar o console: ${error.message}`);
            }
        }
        
        function reloadChat() {
            log('üîÑ Recarregando chat...');
            const iframe = document.getElementById('chatFrame');
            iframe.src = iframe.src;
            updateStatus('‚è≥ Recarregando chat...', 'loading');
        }
        
        function checkConsole() {
            log('üîç Abrindo DevTools para verifica√ß√£o manual');
            alert('Abra o DevTools (F12) e verifique a aba Console para erros.\n\nProcure por erros relacionados a:\n- useEffect\n- loadConversations\n- cleanupEmptyConversations\n- src_07023967._.js');
        }
        
        function testNewConversation() {
            log('üí¨ Teste de nova conversa - verifique manualmente no chat');
            alert('Clique no bot√£o "+" no chat para criar uma nova conversa e observe se h√° erros no console.');
        }
        
        // Verificar se o servidor est√° rodando
        fetch('http://localhost:3000/api/health')
            .then(response => {
                if (response.ok) {
                    log('‚úÖ Servidor est√° rodando');
                } else {
                    log('‚ö†Ô∏è Servidor respondeu com erro');
                }
            })
            .catch(error => {
                log('‚ùå Erro ao conectar com servidor: ' + error.message);
            });
    </script>
</body>
</html> 